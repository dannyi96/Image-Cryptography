<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Rubik's Principle based Image Cryptography</title>
        <meta charset="UTF-8">
        <link rel="icon" href="./assets/icons/rubik.ico" type="image/x-icon">
        <link rel="stylesheet" href="./css/style.css"/>
        <link rel="stylesheet" href="https://pyscript.net/releases/2023.11.1/core.css" />
        <script type="module" src="https://pyscript.net/releases/2023.11.1/core.js"></script>
    </head>
    <body>
        <h1>Rubik's Principle based Image Cryptography</h1>
        <hr/>
        <div class="crypto-container">
            <div class="image-container">
                Input Image
                <img id="input-image" src="./assets/imgs/placeholder.png" alt="Uploaded Image" width="300px" height="300px">
                <input type="file" id="image" accept="image/*" onchange="previewImage(event)">
            </div>
            <button id="transform-image"> Encrypt </button>
            <div class="image-container">
                Output Image
                <img id="output-image" src="./assets/imgs/placeholder.png" alt="Uploaded Image" width="300px" height="300px">
            </div>
        </div>
        <script src="./js/script.js"></script>

        <py-config>
            {
                "packages": ["rubikencryptor"]
            }
        </py-config>
        <py-script>
            from rubikencryptor.rubikencryptor import RubikCubeCrypto
            from PIL import Image
            import re
            from io import BytesIO
            import base64
            from pyscript import when, display, document

            @when("click", "#transform-image")
            def click_handler(event):
                image_prefix, image_data = document.getElementById('input-image').src.split('base64,')
                image_bytes = base64.b64decode(image_data)
                print(image_bytes)
                input_image = Image.open(BytesIO(image_bytes))
                print(input_image)
                encryptor = RubikCubeCrypto(input_image)
                print('HERE')
                encrypted_image = encryptor.encrypt(alpha=8, iter_max=1, key_filename='key.txt')
                print('HERE 2')
                print('HERE 3')
                output_buffer = BytesIO()
                encrypted_image.save(output_buffer, format=input_image.format)
                image_bytes = output_buffer.getvalue()
                encoded_image = base64.b64encode(image_bytes).decode('utf-8')
                print(encoded_image)
                document.getElementById('output-image').src = image_prefix + 'base64,' + encoded_image
        </py-script>

    </body>
</html>